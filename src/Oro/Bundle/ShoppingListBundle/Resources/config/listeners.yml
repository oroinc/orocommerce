services:
    oro_shopping_list.event_listener.shopping_list_total_listener:
        class: 'Oro\Bundle\ShoppingListBundle\EventListener\ShoppingListTotalListener'
        arguments:
            - '@doctrine'
            - '@oro_config.manager'
        tags:
            - { name: kernel.event_listener, event: oro_pricing.combined_price_list.update, method: onPriceListUpdate }
            - { name: kernel.event_listener, event: oro_pricing.customer.combined_price_list.update, method: onCustomerPriceListUpdate }
            - { name: kernel.event_listener, event: oro_pricing.customer_group.combined_price_list.update, method: onCustomerGroupPriceListUpdate }
            - { name: kernel.event_listener, event: oro_pricing.website.combined_price_list.update, method: onWebsitePriceListUpdate }
            - { name: kernel.event_listener, event: oro_pricing.config.combined_price_list.update, method: onConfigPriceListUpdate }

    oro_shopping_list.event_listener.pricing_storage.shopping_list_total_listener:
        class: 'Oro\Bundle\ShoppingListBundle\EventListener\FlatPricingShoppingListTotalListener'
        arguments:
            - '@doctrine'
        tags:
            - { name: kernel.event_listener, event: oro_pricing.pricing_storage.mass_storage_update, method: onPriceListUpdate }
            - { name: kernel.event_listener, event: oro_pricing.pricing_storage.customer_relation_update, method: onCustomerPriceListUpdate }
            - { name: kernel.event_listener, event: oro_pricing.pricing_storage.customer_group_relation_update, method: onCustomerGroupPriceListUpdate }
            - { name: kernel.event_listener, event: oro_pricing.pricing_storage.website_relation_update, method: onWebsitePriceListUpdate }

    oro_shopping_list.event_listener.line_item_preloading:
        parent: oro_entity.event_listener.default_preloading
        tags:
            - { name: kernel.event_listener, event: oro_entity.preload_entity.lineitem, method: onPreload }
            - { name: kernel.event_listener, event: oro_entity.preload_entity.productkititemlineitem, method: onPreload }

    oro_shopping_list.migration.demo_data_fixtures_listener.shopping_list_totals:
        class: 'Oro\Bundle\ShoppingListBundle\EventListener\ShoppingListTotalsDemoDataFixturesListener'
        arguments:
            - '@doctrine'
            - '@oro_shopping_list.manager.shopping_list_total'
        tags:
            - { name: kernel.event_listener, event: oro_migration.data_fixtures.post_load, method: onPostLoad }

    oro_shopping_list.event_listener.datagrid_line_items_data.preload:
        class: Oro\Bundle\ProductBundle\EventListener\DatagridLineItemsDataPreloadListener
        arguments:
            - '@oro_entity.manager.preloading_manager'
        tags:
            # This listener must be called first as it preloads line items data which might be needed by others.
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-grid, method: onLineItemData, priority: 1024 }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-edit-grid, method: onLineItemData, priority: 1024 }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-grid, method: onLineItemData, priority: 1024 }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-edit-grid, method: onLineItemData, priority: 1024 }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-invalid-line-items-grid, method: onLineItemData, priority: 1024 }

    oro_shopping_list.event_listener.datagrid_line_items_data.basic:
        class: Oro\Bundle\ProductBundle\EventListener\DatagridLineItemsDataListener
        arguments:
            - '@oro_product.layout.data_provider.configurable_products'
            - '@oro_locale.helper.localization'
            - '@oro_attachment.manager'
        tags:
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-checkout-line-items-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-single-page-checkout-line-items-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-invalid-line-items-grid, method: onLineItemData }

    oro_shopping_list.event_listener.datagrid_kit_item_line_items_data.basic:
        class: Oro\Bundle\ProductBundle\EventListener\DatagridLineItemsDataListener
        arguments:
            - '@oro_product.layout.data_provider.configurable_products'
            - '@oro_locale.helper.localization'
            - '@oro_attachment.manager'
        tags:
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-checkout-line-items-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-single-page-checkout-line-items-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-saved-for-later-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-saved-for-later-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-invalid-line-items-grid, method: onLineItemData }

    oro_shopping_list.event_listener.datagrid_line_items_data.webp_aware:
        class: Oro\Bundle\ProductBundle\EventListener\WebpAwareDatagridLineItemsDataListener
        arguments:
            - '@oro_attachment.manager'
        tags:
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-checkout-line-items-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-single-page-checkout-line-items-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-invalid-line-items-grid, method: onLineItemData }

    oro_shopping_list.event_listener.datagrid_kit_item_line_items_data.webp_aware:
        class: Oro\Bundle\ProductBundle\EventListener\WebpAwareDatagridLineItemsDataListener
        arguments:
            - '@oro_attachment.manager'
        tags:
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-checkout-line-items-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-single-page-checkout-line-items-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-saved-for-later-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-saved-for-later-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-invalid-line-items-grid, method: onLineItemData }

    oro_shopping_list.event_listener.datagrid_line_items_data.shopping_list_line_item_basic:
        class: Oro\Bundle\ShoppingListBundle\EventListener\DatagridLineItemsDataListener
        tags:
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-invalid-line-items-grid, method: onLineItemData }

    oro_shopping_list.event_listener.datagrid_line_items_data.edit:
        class: Oro\Bundle\ProductBundle\EventListener\DatagridLineItemsDataEditListener
        arguments:
            - '@oro_product.datagrid.property.product_units'
        tags:
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-invalid-line-items-grid, method: onLineItemData }

    oro_shopping_list.event_listener.datagrid_line_items_data.validation:
        class: Oro\Bundle\ShoppingListBundle\EventListener\DatagridLineItemsDataValidationListener
        arguments:
            - '@validator'
            - '@oro_product.model.product_line_items_holder_factory'
            - '@translator'
        tags:
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-invalid-line-items-grid, method: onLineItemData }

    oro_shopping_list.event_listener.datagrid_line_items_data.validation_by_severity:
        class: Oro\Bundle\ShoppingListBundle\EventListener\DatagridLineItemsDataValidationBySeverityListener
        decorates: oro_shopping_list.event_listener.datagrid_line_items_data.validation
        arguments:
            - '@validator'
            - '@oro_product.model.product_line_items_holder_factory'
            - '@translator'
            - '@oro_shopping_list.mapper.shopping_list_invalid_line_items'
            - '@oro_shopping_list.provider.shopping_list_validation_groups'
        tags:
            - { name: oro_featuretogle.feature, feature: enforce_separate_shopping_list_validations }

    oro_shopping_list.event_listener.datagrid_kit_item_line_items_data.validation:
        class: Oro\Bundle\ShoppingListBundle\EventListener\DatagridLineItemsDataValidationListener
        arguments:
            - '@validator'
            - '@oro_product.model.product_line_items_holder_factory'
            - '@translator'
        tags:
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-saved-for-later-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-saved-for-later-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-invalid-line-items-grid, method: onLineItemData }

    oro_shopping_list.event_listener.datagrid_kit_item_line_items_data.validation_by_severity:
        class: Oro\Bundle\ShoppingListBundle\EventListener\DatagridLineItemsDataValidationBySeverityListener
        decorates: oro_shopping_list.event_listener.datagrid_kit_item_line_items_data.validation
        arguments:
            - '@validator'
            - '@oro_product.model.product_line_items_holder_factory'
            - '@translator'
            - '@oro_shopping_list.mapper.shopping_list_invalid_line_items'
            - '@oro_shopping_list.provider.shopping_list_validation_groups'
        tags:
            - { name: oro_featuretogle.feature, feature: enforce_separate_shopping_list_validations }

    oro_shopping_list.event_listener.datagrid_line_items_data.validation_metadata:
        class: Oro\Bundle\ShoppingListBundle\EventListener\DatagridLineItemsDataValidationMetadataListener
        arguments:
            - '@oro_shopping_list.provider.invalid_shopping_list_line_items'
        tags:
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-invalid-line-items-grid, method: onLineItemData }

    oro_shopping_list.event_listener.datagrid_kit_line_items_data:
        class: Oro\Bundle\ProductBundle\EventListener\DatagridKitLineItemsDataListener
        arguments:
            - '@event_dispatcher'
        tags:
            # This listener must be called first as it collect kit item line items data which might be needed by others.
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-grid, method: onLineItemData, priority: 1024 }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-edit-grid, method: onLineItemData, priority: 1024 }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-checkout-line-items-grid, method: onLineItemData, priority: 1024 }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-single-page-checkout-line-items-grid, method: onLineItemData, priority: 1024 }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-grid, method: onLineItemData, priority: 1024 }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-saved-for-later-edit-grid, method: onLineItemData, priority: 1024 }
            - { name: kernel.event_listener, event: oro_product.datagrid_line_items_data.frontend-customer-user-shopping-list-invalid-line-items-grid, method: onLineItemData, priority: 1024 }

    oro_shopping_list.event_listener.datagrid_kit_item_line_items_data.kit_item:
        class: Oro\Bundle\ProductBundle\EventListener\DatagridKitItemLineItemsDataListener
        arguments:
            - '@oro_locale.helper.localization'
        tags:
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-checkout-line-items-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-single-page-checkout-line-items-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-saved-for-later-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-saved-for-later-edit-grid, method: onLineItemData }
            - { name: kernel.event_listener, event: oro_product.datagrid_kit_item_line_items_data.frontend-customer-user-shopping-list-invalid-line-items-grid, method: onLineItemData }

    oro_shopping_list.event_listener.before_add_index:
        class: 'Oro\Bundle\ShoppingListBundle\EventListener\ShoppingListBeforeAddToIndexListener'
        tags:
            - { name: kernel.event_listener, event: oro_search.before_add_index, method: checkEntityNeedIndex }

    oro_shopping_list.event_listener.checkout_source_entity_clear:
        class: Oro\Bundle\ShoppingListBundle\EventListener\ShoppingListCheckoutSourceEntityClearListener
        tags:
            - { name: kernel.event_listener, event: oro_checkout.checkout_source_entity_clear, method: onCheckoutSourceEntityClear }

    oro_shopping_list.datagrid.event_listener.invalid_shopping_list_line_items_sort_grid:
        class: Oro\Bundle\ShoppingListBundle\Datagrid\EventListener\InvalidShoppingListLineItemsSortGridListener
        arguments:
            - '@doctrine'
            - '@oro_shopping_list.provider.invalid_shopping_list_line_items'
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.after.frontend-customer-user-shopping-list-grid, method: onBuildAfter }
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.after.frontend-customer-user-shopping-list-edit-grid, method: onBuildAfter }
            - { name: kernel.event_listener, event: oro_datagrid.orm_datasource.result.before_query.frontend-customer-user-shopping-list-grid, method: onResultBeforeQuery, priority: -256 }
            - { name: kernel.event_listener, event: oro_datagrid.orm_datasource.result.before_query.frontend-customer-user-shopping-list-edit-grid, method: onResultBeforeQuery, priority: -256 }

    oro_shopping_list.datagrid.event_listener.saved-for-later-line-items:
        class: Oro\Bundle\ShoppingListBundle\Datagrid\EventListener\SavedForLaterLineItemsGridListener
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.before.shopping-list-saved-for-later-line-items-grid, method: onBuildBefore }
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.before.frontend-customer-user-shopping-list-saved-for-later-grid, method: onBuildBefore }
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.before.frontend-customer-user-shopping-list-saved-for-later-edit-grid, method: onBuildBefore }

    oro_shopping_list.datagrid.event_listener.save_for_later_mass_actions:
        class: Oro\Bundle\ShoppingListBundle\Datagrid\EventListener\FrontendLineItemsGrid\SaveForLaterMassActionsListener
        calls:
            - [ setLimitedToDatagrids, [ ['frontend-customer-user-shopping-list-edit-grid'] ] ]
            - [ setOldThemes, [ ['default_60', 'default_51', 'default_50'] ] ]
            - [ setThemeConfigurationProvider, [ '@oro_theme.provider.theme_configuration' ] ]
        tags:
            - { name: kernel.event_listener, event: oro_datagrid.datagrid.build.before.frontend-customer-user-shopping-list-edit-grid, method: onBuildBefore }
            - { name: oro_featuretogle.feature, feature: 'saved_for_later' }
